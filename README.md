# Flow Repo

Dart å®ç°çš„ DejaVu æ•°æ®å¿«ç…§å’ŒåŒæ­¥ç³»ç»Ÿ ğŸš€

[![Dart](https://img.shields.io/badge/Dart-3.0+-blue.svg)](https://dart.dev)
[![License](https://img.shields.io/badge/License-AGPL%203.0-green.svg)](LICENSE)

## ğŸ“– é¡¹ç›®ç®€ä»‹

Flow Repo ä½¿ç”¨ Dart å®ç°çš„æ•°æ®åŒæ­¥ç³»ç»Ÿï¼Œç‰¹åˆ«é€‚åˆ Flutter åº”ç”¨çš„æ•°æ®å¤‡ä»½å’Œå¤šè®¾å¤‡åŒæ­¥ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ”„ **å¢é‡åŒæ­¥**: åªä¼ è¾“å˜åŒ–çš„æ•°æ®å—ï¼ŒèŠ‚çœ 98%+ æµé‡
- ğŸ” **ç«¯åˆ°ç«¯åŠ å¯†**: AES-256 åŠ å¯†ï¼Œäº‘ç«¯æ— æ³•æŸ¥çœ‹æ•°æ®
- ğŸ“¦ **å†…å®¹å»é‡**: åŸºäº SHA-1 å“ˆå¸Œçš„å†…å®¹å¯»å€
- ğŸ—œï¸ **æ•°æ®å‹ç¼©**: ZLib å‹ç¼©å‡å°‘å­˜å‚¨ç©ºé—´
- â˜ï¸ **äº‘ç«¯å¤‡ä»½**: S3 å…¼å®¹å­˜å‚¨ï¼ˆæ”¯æŒé˜¿é‡Œäº‘ OSSï¼‰
- ğŸ”€ **åŒå‘åŒæ­¥**: è‡ªåŠ¨æ£€æµ‹ä¸Šä¼ /ä¸‹è½½æ–¹å‘

## ğŸ¯ æ€§èƒ½è¡¨ç°

### å¢é‡åŒæ­¥æ•ˆæœ

**æµ‹è¯•åœºæ™¯**: 273MB SQLite æ•°æ®åº“æ–°å¢ 1 æ¡è®°å½•

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| ä¸Šä¼ æµé‡ | **5.25MB** | èŠ‚çœ 98.08% â­ï¸ |
| ä¸‹è½½æµé‡ | **5.25MB** | èŠ‚çœ 98.08% â­ï¸ |
| ç´¢å¼•åˆ›å»º | 1.94s | å¿«é€Ÿæ‰«æ |
| åŒæ­¥é€Ÿåº¦ | 7-9s | é«˜æ•ˆä¼ è¾“ |
| æ•°æ®ä¸€è‡´æ€§ | 100% | å®Œå…¨å‡†ç¡® âœ… |

### ä¸ Go ç‰ˆæœ¬å¯¹æ¯”

| æŒ‡æ ‡ | Dart | Go | å·®è· |
|------|------|----|------|
| å¢é‡æµé‡ | 5.25MB | 981KB | 5.4å€ |
| åŒæ­¥é€Ÿåº¦ | 16.25s | 9.08s | 1.8å€ |
| ç´¢å¼•åˆ›å»º | 1.94s | 3.37s | **Dart å¿« 42%** â­ï¸ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
dart pub get
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
AES_KEY=your_32_byte_aes_key_here_12345
OSS_ACCESS_KEY_ID=your_access_key
OSS_ACCESS_KEY_SECRET=your_secret_key
OSS_BUCKET_NAME=your_bucket_name
OSS_ENDPOINT=oss-cn-shenzhen.aliyuncs.com
OSS_REGION=oss-cn-shenzhen
```

### ä½¿ç”¨ç¤ºä¾‹

```bash
# åˆ›å»ºç´¢å¼•
dart run bin/main.dart index -d ./data-0 --memo "Initial backup"

# åŒæ­¥åˆ°äº‘ç«¯
dart run bin/main.dart sync -d ./data-0

# åŒæ­¥åˆ°å¦ä¸€ä¸ªç›®å½•ï¼ˆæ³¨æ„ä½¿ç”¨ä¸åŒçš„ repo-pathï¼‰
dart run bin/main.dart sync -d ./data-1 -r ./.flow-repo-data1
```

## ğŸ“ ä»“åº“ç»“æ„

```
.flow-repo/
â”œâ”€â”€ indexes/          # ç´¢å¼•æ–‡ä»¶ï¼ˆå‹ç¼©ï¼‰
â”‚   â””â”€â”€ <index-id>
â”œâ”€â”€ objects/          # æ•°æ®å—ï¼ˆå‹ç¼©+åŠ å¯†ï¼‰
â”‚   â””â”€â”€ <2-char>/
â”‚       â””â”€â”€ <chunk-id>
â”œâ”€â”€ files/            # æ–‡ä»¶å…ƒæ•°æ®ï¼ˆå‹ç¼©+åŠ å¯†ï¼‰
â”‚   â””â”€â”€ <2-char>/
â”‚       â””â”€â”€ <file-id>
â””â”€â”€ refs/             # å¼•ç”¨
    â””â”€â”€ latest        # æœ€æ–°ç´¢å¼•å¼•ç”¨
```

## ğŸ”§ æŠ€æœ¯å®ç°

### åˆ†å—ç®—æ³•
- **ç­–ç•¥**: å›ºå®š 8MB åˆ†å—
- **ä¼˜åŠ¿**: å—è¾¹ç•Œç¨³å®šï¼Œå¢é‡æ•ˆæœå¥½
- **é€‚ç”¨**: é¢‘ç¹ä¿®æ”¹çš„æ•°æ®

### åŠ å¯†æ–¹æ¡ˆ
- **ç®—æ³•**: AES-256-CBC
- **å¯†é’¥**: 32 å­—èŠ‚
- **IV**: å…¨é›¶ï¼ˆç®€åŒ–å®ç°ï¼‰

### å‹ç¼©æ–¹æ¡ˆ
- **ç®—æ³•**: ZLib
- **ç´¢å¼•**: åªå‹ç¼©ä¸åŠ å¯†
- **æ•°æ®**: å…ˆå‹ç¼©å†åŠ å¯†

### äº‘å­˜å‚¨
- **SDK**: aws_s3_api
- **å…¼å®¹**: S3ã€é˜¿é‡Œäº‘ OSS ç­‰
- **å¹¶å‘**: é™åˆ¶å¹¶å‘æ•°é¿å…è¿‡è½½

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

AGPL-3.0

## ğŸ™ è‡´è°¢

- [DejaVu](https://github.com/siyuan-note/dejavu) - åŸå§‹è®¾è®¡å’Œå®ç°
- [restic/chunker](https://github.com/restic/chunker) - åˆ†å—ç®—æ³•å‚è€ƒ


---

**Status**: âœ… ç”Ÿäº§å¯ç”¨  
**Version**: 1.0.0  
**Last Update**: 2026-01-03

